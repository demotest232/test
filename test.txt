@Test
void testGzipPath() throws Exception {
    Enumeration<String> gzipEnum = Collections.enumeration(Collections.singletonList("gzip"));
    when(mockRequest.getHeaders("Accept-Encoding")).thenReturn(gzipEnum);

    FilterChain capturingChain = (req, res) -> {
        assertTrue(res instanceof HttpServletResponseWrapper);
        // Optionally, invoke output stream/writer
        ((HttpServletResponseWrapper)res).getOutputStream();
        ((HttpServletResponseWrapper)res).getWriter();
    };

    filter.doFilter(mockRequest, mockResponse, capturingChain);
}
